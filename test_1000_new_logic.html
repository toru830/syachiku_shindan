<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1000回テスト - 新ロジック版</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .result-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .result-item.rare {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .result-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .result-count {
            color: #666;
            font-size: 0.9em;
        }
        .result-percentage {
            color: #007bff;
            font-weight: bold;
        }
        .summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>社畜診断 1000回テスト（新ロジック版）</h1>
        <div id="status">テスト実行中...</div>
        <div id="summary" class="summary" style="display: none;"></div>
        <div id="results" class="results"></div>
    </div>

    <script>
        // 本番のscript.jsから診断ロジックをコピー
        const questionsOriginal = [
            {
                text: "終電の時間でも仕事が終わっていなければ残る",
                axes: { dedication: 1, sacrifice: 1, stress: 0.5, relationship: 0 },
                options: [
                    { text: "当然残る", value: 5, emoji: "🔥" },
                    { text: "残る", value: 4, emoji: "💼" },
                    { text: "たまに残る", value: 3, emoji: "🤔" },
                    { text: "基本帰る", value: 2, emoji: "🚶" },
                    { text: "秒で帰る", value: 1, emoji: "💨" },
                    { text: "終電？定時で帰ります", value: 0, emoji: "😎" }
                ]
            },
            {
                text: "お腹が空いたが午後の仕事に向けてランチを抜く",
                axes: { dedication: 0.8, sacrifice: 1, stress: 0, relationship: 0 },
                options: [
                    { text: "当然抜く", value: 5, emoji: "😤" },
                    { text: "よく抜く", value: 4, emoji: "😣" },
                    { text: "たまに抜く", value: 3, emoji: "🤷" },
                    { text: "基本食べる", value: 2, emoji: "🍱" },
                    { text: "絶対食べる", value: 1, emoji: "😋" },
                    { text: "豪華ランチ必須", value: 0, emoji: "🍽️" }
                ]
            },
            {
                text: "上司からの休日の連絡にすぐ返信する",
                axes: { dedication: 0.7, sacrifice: 0.6, stress: 0, relationship: 1 },
                options: [
                    { text: "秒で返信", value: 5, emoji: "⚡" },
                    { text: "すぐ返信", value: 4, emoji: "📱" },
                    { text: "わりと早く", value: 3, emoji: "✉️" },
                    { text: "後で返す", value: 2, emoji: "⏰" },
                    { text: "月曜に返す", value: 1, emoji: "📅" },
                    { text: "既読スルー", value: 0, emoji: "🙈" }
                ]
            },
            {
                text: "体調が悪くても会社に出勤する",
                axes: { dedication: 0.9, sacrifice: 1, stress: 0.7, relationship: 0 },
                options: [
                    { text: "這ってでも出社", value: 5, emoji: "🤒" },
                    { text: "絶対出社", value: 4, emoji: "😷" },
                    { text: "なんとか出社", value: 3, emoji: "🤧" },
                    { text: "悪かったら休む", value: 2, emoji: "🏥" },
                    { text: "余裕で休む", value: 1, emoji: "😴" },
                    { text: "有給消化チャンス", value: 0, emoji: "🏖️" }
                ]
            },
            {
                text: "同僚が困っていたら自分の仕事を後回しにして手伝う",
                axes: { dedication: 0.3, sacrifice: 0.7, stress: 0, relationship: 1 },
                options: [
                    { text: "即座に手伝う", value: 5, emoji: "🦸" },
                    { text: "すぐ手伝う", value: 4, emoji: "🤝" },
                    { text: "余裕あれば手伝う", value: 3, emoji: "👍" },
                    { text: "自分優先", value: 2, emoji: "🙋" },
                    { text: "基本手伝わない", value: 1, emoji: "🚫" },
                    { text: "見て見ぬふり", value: 0, emoji: "🙈" }
                ]
            },
            {
                text: "会社の飲み会は全て参加する",
                axes: { dedication: 0.5, sacrifice: 0.6, stress: 0, relationship: 1 },
                options: [
                    { text: "全参加", value: 5, emoji: "🍻" },
                    { text: "ほぼ参加", value: 4, emoji: "🍺" },
                    { text: "たまに参加", value: 3, emoji: "🥂" },
                    { text: "あまり行かない", value: 2, emoji: "🏠" },
                    { text: "ほぼ不参加", value: 1, emoji: "🙅" },
                    { text: "飲み会アレルギー", value: 0, emoji: "😫" }
                ]
            },
            {
                text: "有給休暇を取ることに罪悪感を感じる",
                axes: { dedication: 0.8, sacrifice: 0.8, stress: 0.5, relationship: 0.3 },
                options: [
                    { text: "すごく感じる", value: 5, emoji: "😰" },
                    { text: "感じる", value: 4, emoji: "😥" },
                    { text: "少し感じる", value: 3, emoji: "🤔" },
                    { text: "あまり感じない", value: 2, emoji: "😌" },
                    { text: "全く感じない", value: 1, emoji: "😄" },
                    { text: "権利です", value: 0, emoji: "👑" }
                ]
            },
            {
                text: "仕事のことを考えて眠れない夜がある",
                axes: { dedication: 0.7, sacrifice: 0.5, stress: 1, relationship: 0 },
                options: [
                    { text: "毎日", value: 5, emoji: "😵" },
                    { text: "よくある", value: 4, emoji: "😫" },
                    { text: "たまにある", value: 3, emoji: "😪" },
                    { text: "ほぼない", value: 2, emoji: "😌" },
                    { text: "全くない", value: 1, emoji: "😴" },
                    { text: "秒で寝れる", value: 0, emoji: "💤" }
                ]
            },
            {
                text: "家族や友人との約束より仕事を優先する",
                axes: { dedication: 1, sacrifice: 1, stress: 0, relationship: 0 },
                options: [
                    { text: "絶対仕事", value: 5, emoji: "💼" },
                    { text: "基本仕事", value: 4, emoji: "📊" },
                    { text: "たまに仕事", value: 3, emoji: "⚖️" },
                    { text: "半々", value: 2, emoji: "🤝" },
                    { text: "基本プライベート", value: 1, emoji: "🎉" },
                    { text: "絶対プライベート", value: 0, emoji: "🏖️" }
                ]
            },
            {
                text: "会社のために自腹で備品や飲食物を購入することがある",
                axes: { dedication: 0.9, sacrifice: 1, stress: 0, relationship: 0.5 },
                options: [
                    { text: "よくある", value: 5, emoji: "💸" },
                    { text: "ある", value: 4, emoji: "💰" },
                    { text: "たまにある", value: 3, emoji: "🤷" },
                    { text: "ほぼない", value: 2, emoji: "🙅" },
                    { text: "絶対ない", value: 1, emoji: "❌" },
                    { text: "経費でしょ", value: 0, emoji: "💳" }
                ]
            },
            {
                text: "在宅ワークで昼寝をしている人が羨ましい",
                axes: { dedication: 1, sacrifice: 0, stress: 0, relationship: 0 },
                options: [
                    { text: "これ私", value: 5, emoji: "😴" },
                    { text: "すごく羨ましい", value: 4, emoji: "😍" },
                    { text: "羨ましい", value: 3, emoji: "🥺" },
                    { text: "無感情", value: 2, emoji: "😐" },
                    { text: "ゆるせない", value: 1, emoji: "😠" },
                    { text: "決して許せない", value: 0, emoji: "😡" }
                ],
                reverse: true
            },
            {
                text: "金曜日の夕方、やる気が出ない",
                axes: { dedication: 0.8, sacrifice: 0, stress: 0, relationship: 0 },
                options: [
                    { text: "これ私", value: 5, emoji: "😩" },
                    { text: "すごくそう", value: 4, emoji: "😅" },
                    { text: "わりとそう", value: 3, emoji: "😪" },
                    { text: "普通に働ける", value: 2, emoji: "😊" },
                    { text: "バリバリ働ける", value: 1, emoji: "💪" },
                    { text: "金曜が一番燃える", value: 0, emoji: "🔥" }
                ],
                reverse: true
            },
            {
                text: "会議中にスマホをいじったことがある",
                axes: { dedication: 0.7, sacrifice: 0, stress: 0, relationship: 0.5 },
                options: [
                    { text: "毎回", value: 5, emoji: "📱" },
                    { text: "よくある", value: 4, emoji: "👀" },
                    { text: "たまに", value: 3, emoji: "🤭" },
                    { text: "ほぼない", value: 2, emoji: "🙅" },
                    { text: "絶対しない", value: 1, emoji: "😇" },
                    { text: "会議は真剣勝負", value: 0, emoji: "💼" }
                ],
                reverse: true
            },
            {
                text: "締め切り前日にならないとやる気が出ない",
                axes: { dedication: 0.6, sacrifice: 0, stress: 0.3, relationship: 0 },
                options: [
                    { text: "これ私", value: 5, emoji: "😭" },
                    { text: "完全にそう", value: 4, emoji: "😅" },
                    { text: "わりとそう", value: 3, emoji: "🤔" },
                    { text: "普通", value: 2, emoji: "😐" },
                    { text: "計画的にやる", value: 1, emoji: "📝" },
                    { text: "余裕を持ってやる", value: 0, emoji: "✅" }
                ],
                reverse: true
            },
            {
                text: "仕事中にネットサーフィンをする",
                axes: { dedication: 0.9, sacrifice: 0, stress: 0, relationship: 0 },
                options: [
                    { text: "常に", value: 5, emoji: "💻" },
                    { text: "よくする", value: 4, emoji: "🌐" },
                    { text: "たまに", value: 3, emoji: "🤫" },
                    { text: "ほぼしない", value: 2, emoji: "🙅" },
                    { text: "絶対しない", value: 1, emoji: "🚫" },
                    { text: "仕事に集中してる", value: 0, emoji: "💪" }
                ],
                reverse: true
            }
        ];

        // シャッフル用の質問配列
        let questions = [];

        // 配列をシャッフルする関数
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // 本番の診断ロジック（script.jsからコピー）
        function computeAxes() {
            let scores = {
                dedication: 0,
                sacrifice: 0,
                stress: 0,
                relationship: 0
            };

            questions.forEach(q => {
                const multiplier = q.reverse ? -1 : 1;
                scores.dedication += 3 * q.axes.dedication * multiplier;
                scores.sacrifice += 3 * q.axes.sacrifice * multiplier;
                scores.stress += 3 * q.axes.stress * multiplier;
                scores.relationship += 3 * q.axes.relationship * multiplier;
            });

            // 各軸の最大・最小スコアを計算
            let maxDedication = 0, minDedication = 0;
            let maxSacrifice = 0, minSacrifice = 0;
            let maxStress = 0, minStress = 0;
            let maxRelationship = 0, minRelationship = 0;
            
            questions.forEach(q => {
                const multiplier = q.reverse ? -1 : 1;
                const dedWeight = q.axes.dedication * multiplier;
                const sacWeight = q.axes.sacrifice * multiplier;
                const strWeight = q.axes.stress * multiplier;
                const relWeight = q.axes.relationship * multiplier;
                
                maxDedication += Math.max(dedWeight * 5, dedWeight * 0);
                minDedication += Math.min(dedWeight * 5, dedWeight * 0);
                
                maxSacrifice += Math.max(sacWeight * 5, sacWeight * 0);
                minSacrifice += Math.min(sacWeight * 5, sacWeight * 0);
                
                maxStress += Math.max(strWeight * 5, strWeight * 0);
                minStress += Math.min(strWeight * 5, strWeight * 0);
                
                maxRelationship += Math.max(relWeight * 5, relWeight * 0);
                minRelationship += Math.min(relWeight * 5, relWeight * 0);
            });
            
            // スコアを0-100%に正規化
            function normalizeScore(score, min, max) {
                if (max === min) return 50;
                return Math.max(0, Math.min(100, ((score - min) / (max - min)) * 100));
            }
            
            return {
                dedication: normalizeScore(scores.dedication, minDedication, maxDedication),
                sacrifice: normalizeScore(scores.sacrifice, minSacrifice, maxSacrifice),
                stress: normalizeScore(scores.stress, minStress, maxStress),
                relationship: normalizeScore(scores.relationship, minRelationship, maxRelationship)
            };
        }

        // 新しいシンプルな診断ロジック
        function getResultType(normalizedScores) {
            const ax = {
                d: normalizedScores.dedication,
                s: normalizedScores.sacrifice,
                r: normalizedScores.stress,
                h: normalizedScores.relationship
            };
            
            console.log('診断開始 - スコア:', ax);
            
            // レア判定（極端な値のみ）
            if (ax.d >= 85 && ax.s >= 85 && ax.r >= 85 && ax.h >= 85) {
                console.log('レア判定: 生粋の社畜');
                return TYPES.ELITE;
            }
            if (ax.d <= 15 && ax.s <= 15 && ax.r <= 15 && ax.h <= 15) {
                console.log('レア判定: 自由人');
                return TYPES.FREE;
            }
            
            // 非レアタイプを均等に分散させるためのシンプルなロジック
            const nonRareTypes = Object.values(TYPES).filter(t => !t.rare);
            console.log('非レアタイプ数:', nonRareTypes.length);
            
            // スコアの合計値を使って均等分散
            const totalScore = ax.d + ax.s + ax.r + ax.h;
            const normalizedTotal = (totalScore / 400) * 100; // 0-100に正規化
            
            // 各タイプに均等な範囲を割り当て
            const rangePerType = 100 / nonRareTypes.length;
            const typeIndex = Math.floor(normalizedTotal / rangePerType);
            const selectedType = nonRareTypes[Math.min(typeIndex, nonRareTypes.length - 1)];
            
            console.log('選択されたタイプ:', selectedType.name);
            return selectedType;
        }

        // === タイプ定義（16種類・新名称仕様） ===
        const TYPES = {
            ELITE: { key:"ELITE", name:"生粋の社畜", icon:"🔥",
                desc:"全軸が非常に高い究極の献身者。仕事と一体化し、成果を使命とする存在。", 
                rare:true, tags:["究極の献身","燃え尽き注意"],
                centroid:{d:95,s:95,r:95,h:95},
                level: 100 },

            BURNOUT: { key:"BURNOUT", name:"限界突破社畜", icon:"⚠️",
                desc:"献身・犠牲が高く、耐性と人間関係が低い。限界まで挑み続ける頑張り屋タイプ。",
                centroid:{d:80,s:80,r:20,h:20}, tags:["過負荷","要休息"],
                level: 95 },

            STOIC: { key:"STOIC", name:"無敗の職人社畜", icon:"🥇",
                desc:"高献身・高犠牲・高耐性。黙々と成果を積み上げるプロ意識の持ち主。",
                centroid:{d:85,s:75,r:85,h:35}, tags:["自己規律","粘り強さ"],
                level: 85 },

            LONE: { key:"LONE", name:"孤高の成果主義社畜", icon:"🐺",
                desc:"献身・犠牲・耐性は高く、人間関係は控えめ。結果に全てを賭ける孤高の戦士。",
                centroid:{d:85,s:75,r:85,h:15}, tags:["独立独歩","集中力"],
                level: 75 },

            KIND: { key:"KIND", name:"心優しき社畜", icon:"💐",
                desc:"高献身で人間関係を大切にする温厚タイプ。チームを支える縁の下の力持ち。",
                centroid:{d:75,s:25,r:25,h:85}, tags:["思いやり","共感"],
                level: 65 },

            SENSITIVE: { key:"SENSITIVE", name:"誠実な観察社員", icon:"🌿",
                desc:"献身は高いが犠牲と耐性は低い。誠実で丁寧、感受性豊かな観察者。",
                centroid:{d:75,s:25,r:25,h:25}, tags:["慎重","誠実"],
                level: 55 },

            TEAM: { key:"TEAM", name:"共創リーダー社員", icon:"🤝",
                desc:"高献身・高耐性・人間関係高。協働で成果を生み、周囲を導くタイプ。",
                centroid:{d:70,s:40,r:80,h:85}, tags:["協調","信頼"],
                level: 60 },

            PACE: { key:"PACE", name:"マイペース社員", icon:"🧭",
                desc:"献身・耐性が高いが関係性は控えめ。自律して淡々と結果を出す。",
                centroid:{d:70,s:35,r:80,h:35}, tags:["自律","安定"],
                level: 45 },

            YURUFUWA: { key:"YURUFUWA", name:"ゆるふわ社畜", icon:"🫧",
                desc:"献身は低いが犠牲が高く、人のために動くやさしき奉仕者。自己犠牲に注意。",
                centroid:{d:25,s:80,r:25,h:85}, tags:["優しさ","自己犠牲"],
                level: 35 },

            HIDDEN: { key:"HIDDEN", name:"隠れ疲労社畜", icon:"🌧️",
                desc:"バランス型だが耐性が低い。無自覚に疲れをためがちな頑張り屋。",
                centroid:{d:45,s:45,r:20,h:45}, tags:["回復重視","ストレス管理"],
                level: 40 },

            NICE: { key:"NICE", name:"お人好し社員", icon:"😊",
                desc:"全体中庸・人間関係が高い。潤滑油として場を整え、支援に長ける。",
                centroid:{d:45,s:45,r:55,h:88}, tags:["調整役","優しさ"],
                level: 30 },

            REAL: { key:"REAL", name:"現実派社員", icon:"🧱",
                desc:"全体中庸・人間関係控えめ。合理的・実務的で堅実なリアリスト。",
                centroid:{d:55,s:55,r:55,h:15}, tags:["堅実","実務力"],
                level: 25 },

            FAMILY: { key:"FAMILY", name:"家庭が大事社員", icon:"🏡",
                desc:"低献身・低犠牲・人間関係高。家族や私生活を大切にするバランス型。",
                centroid:{d:25,s:25,r:55,h:85}, tags:["安定","ライフ重視"],
                level: 20 },

            LWB: { key:"LWB", name:"バランサー社員", icon:"⚖️",
                desc:"中庸で調和志向。仕事と生活の両立を重視するスマートワーカー。",
                centroid:{d:58,s:32,r:55,h:55}, tags:["調和","柔軟性"],
                level: 15 },

            ABLE: { key:"ABLE", name:"成果最適化社畜", icon:"🚀",
                desc:"高献身・中犠牲・高耐性。戦略的に動く結果重視タイプ。",
                centroid:{d:78,s:55,r:85,h:55}, tags:["戦略性","効率重視"],
                level: 10 },

            FREE: { key:"FREE", name:"自由人", icon:"🕊️",
                desc:"全軸が低い自由奔放タイプ。自分の感性を軸に生きるクリエイター気質。",
                rare:true, tags:["自由","創造性"],
                centroid:{d:5,s:5,r:5,h:5},
                level: 0 },
        };

        // 1000回テスト実行
        function runTest() {
            const results = {};
            const errors = [];
            
            for (let i = 0; i < 1000; i++) {
                try {
                    // ランダムな回答を生成
                    questions = shuffleArray(questionsOriginal);
                    const scores = {
                        dedication: 0,
                        sacrifice: 0,
                        stress: 0,
                        relationship: 0
                    };
                    
                    // ランダムな回答を選択
                    questions.forEach(q => {
                        const randomOption = q.options[Math.floor(Math.random() * q.options.length)];
                        const multiplier = q.reverse ? -1 : 1;
                        
                        scores.dedication += randomOption.value * q.axes.dedication * multiplier;
                        scores.sacrifice += randomOption.value * q.axes.sacrifice * multiplier;
                        scores.stress += randomOption.value * q.axes.stress * multiplier;
                        scores.relationship += randomOption.value * q.axes.relationship * multiplier;
                    });
                    
                    // 正規化
                    const normalizedScores = computeAxes();
                    const resultType = getResultType(normalizedScores);
                    
                    if (resultType && resultType.name) {
                        results[resultType.name] = (results[resultType.name] || 0) + 1;
                    } else {
                        errors.push(`Test ${i+1}: No result type found`);
                    }
                } catch (error) {
                    errors.push(`Test ${i+1}: ${error.message}`);
                }
            }
            
            displayResults(results, errors);
        }

        function displayResults(results, errors) {
            const statusEl = document.getElementById('status');
            const summaryEl = document.getElementById('summary');
            const resultsEl = document.getElementById('results');
            
            statusEl.textContent = 'テスト完了！';
            
            // サマリー表示
            const totalTests = 1000 - errors.length;
            const typeCount = Object.keys(results).length;
            const rareTypes = ['生粋の社畜', '自由人'];
            const rareCount = rareTypes.reduce((sum, type) => sum + (results[type] || 0), 0);
            const nonRareCount = totalTests - rareCount;
            
            summaryEl.innerHTML = `
                <h3>テスト結果サマリー</h3>
                <p><strong>総テスト数:</strong> 1000回</p>
                <p><strong>成功:</strong> ${totalTests}回</p>
                <p><strong>エラー:</strong> ${errors.length}回</p>
                <p><strong>出現タイプ数:</strong> ${typeCount}種類</p>
                <p><strong>レアタイプ出現:</strong> ${rareCount}回 (${(rareCount/totalTests*100).toFixed(1)}%)</p>
                <p><strong>非レアタイプ出現:</strong> ${nonRareCount}回 (${(nonRareCount/totalTests*100).toFixed(1)}%)</p>
            `;
            summaryEl.style.display = 'block';
            
            // エラー表示
            if (errors.length > 0) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error';
                errorDiv.innerHTML = `<strong>エラー (${errors.length}件):</strong><br>${errors.slice(0, 10).join('<br>')}${errors.length > 10 ? '<br>...' : ''}`;
                resultsEl.appendChild(errorDiv);
            }
            
            // 結果表示
            const sortedResults = Object.entries(results)
                .sort((a, b) => b[1] - a[1])
                .map(([name, count]) => {
                    const percentage = (count / totalTests * 100).toFixed(1);
                    const isRare = rareTypes.includes(name);
                    return { name, count, percentage, isRare };
                });
            
            sortedResults.forEach(result => {
                const div = document.createElement('div');
                div.className = `result-item ${result.isRare ? 'rare' : ''}`;
                div.innerHTML = `
                    <div class="result-name">${result.name}</div>
                    <div class="result-count">${result.count}回</div>
                    <div class="result-percentage">${result.percentage}%</div>
                `;
                resultsEl.appendChild(div);
            });
        }

        // テスト開始
        runTest();
    </script>
</body>
</html>